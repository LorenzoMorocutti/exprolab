<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Exprolab_assignment2: Experimental Robotics Laboratory</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Exprolab_assignment2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Experimental Robotics Laboratory </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the repository for the second assignment of the experimental robotics course of Unige.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Description of the repository</h1>
<p>In the repository it's possible to find:</p><ul>
<li><em>action</em> folder: contains the structure of the Moving action;</li>
<li><em>common</em> folder: contains the plan and the problem generated by ROSplan;</li>
<li><em>config</em> folder: contains the rviz simulation file;</li>
<li><em>include</em> folder: contains the header of the ActionInterface;</li>
<li><em>launch</em> folder: contains the launch files;</li>
<li><em>msg</em> folder: contains the structure of the ErlOracle messagge;</li>
<li><em>scripts</em> folder: contains scripts of three nodes of the assignment;</li>
<li><em>src</em> folder: contains the cpp codes associated to the actions and the simulation;</li>
<li><em>srv</em> folder: contains the structure of the services used in the assignment;</li>
<li><em>urdf</em> folder: contains the urdf model of the robot used;</li>
<li><em>world</em> folder: contains the world file used for the simulation environment;</li>
<li><em>domain and problem</em>: pddl files used by ROSplan;</li>
<li><em>script.sh</em>: shell script.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Software Architecture</h1>
<p>We can see in the image below the component diagram of the software:</p>
<p><img src="images_videos/component_diagram.jpeg" alt="immagine" class="inline"/></p>
<ul>
<li><b>node_hint</b>: The <code>node_hint</code> node implements the node that receives the hint from the oracle and saves it in the ontology. The armor node will tell us if the hint is malformed or valid. It also implements the checking of the completeness and consistency of the hypothesis. Eventually retrieves the field of an hypothesis from the ontology, given an ID;</li>
<li><b><a class="el" href="namespacegeneration__problem.html">generation_problem</a></b>: The <code><a class="el" href="namespacegeneration__problem.html">generation_problem</a></code> node implements the various calls to ROSplan to generate the plan run by the robot. It requests feedback from the plan and produces new plans until the goal is reached. It also updates the knowedge base;</li>
<li><b><a class="el" href="namespacego__to__point.html">go_to_point</a></b>: The <code><a class="el" href="namespacego__to__point.html">go_to_point</a></code> node controls the behavior of the robot according to the <a class="el" href="namespacego__to__point.html">go_to_point</a> behavior via an action server. A FSM is used to model the behavior every time a new goal pose is received: firstly the robot alight its position with the goal's one, then it goes straight to the goal position, it aligns with the goal orientation and then the goal pose is reached;</li>
<li><b>Moveto</b>: The <code>Moveto</code> node implements the 'move_to' pddl action to a waypoint. This is possible thanks to the <a class="el" href="namespacego__to__point.html">go_to_point</a> node;</li>
<li><b>Moveaway</b>: The <code>Moveaway</code> node implements the 'move_away_from_home' pddl action to move the robot from home to the waypoint chosen by the planner. This is possible thanks to the <a class="el" href="namespacego__to__point.html">go_to_point</a> node;</li>
<li><b>Movehome</b>: The <code>Movehome</code> node implements the 'move_home' pddl action to return to the home waypoint. This is possible thanks to the <a class="el" href="namespacego__to__point.html">go_to_point</a> node;</li>
<li><b>Checkhint</b>: The <code>Checkhint</code> node implements the 'check_hint' pddl action to move the robotic arm to look for the hint. It uses the 'moveit' library to do so;</li>
<li><b>Checkcomplete</b>: The <code>Checkcomplete</code> node implements the 'check_complete_hypotesis' pddl action to check if the passed hypotesis is complete and consistent;</li>
<li><b>Checkresult</b>: The <code>Checkresult</code> node implements the 'check_result' pddl action to check if the complete hypotesis is the correct one and, in that case, print the solution.</li>
<li><b>ARMOR</b>: The <code>ARMOR</code> node is the one that "answers" to all the requests that comes from the node_hint about the ontology and management of the hypotesis.</li>
</ul>
<p>In the image is also possible to see which services/topics are used to communicate between the nodes (the lollipop is used for the services while the double arrow is used for the topics of the publishers/subscribers).</p>
<p>About the nodes, it is been also reported the rqt_graph in which are seen only the topics of the publishers/subscribers:</p>
<p><img src="images_videos/rqt_graph.jpeg" alt="immagine" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md3"></a>
Temporal diagram</h2>
<p>In the following image is represented the temporal diagram, of the software:</p>
<p><img src="images_videos/temporal_diagram.jpeg" alt="immagine" class="inline"/></p>
<p>It shows in a explicit way the temporal connections of the nodes: we can see that the the structure follows linearly the execution of the plan. There are also the <code>Moveit</code> and <code>Go_to_point</code> nodes that have been reported to clarify when they are called and used. The create hypotesis and simulation nodes are called a lot of times so, to not make the diagram really heavy to read, I didn't inserted them (still in the <em>component_diagram</em> we can see when the services are called). The temporal passagges are to be read from the top to bottom of the diagram (the upper one is the first step, the lower one is the last).</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Actions</h2>
<p>The only action used in the software is <em>Moving</em>, that contains all the information about the goal position and the robot position: </p><div class="fragment"><div class="line">geometry_msgs/PoseStamped target_pose</div>
<div class="line">---</div>
<div class="line">geometry_msgs/Pose actual_pose</div>
<div class="line">---</div>
<div class="line">string stat</div>
</div><!-- fragment --><p>The request is of the type geometry_msgs and the response is composed by a geometry_msgs and a string.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Services</h2>
<p>The custom services used in the software are the following:</p>
<ul>
<li><em>hint</em>: the service used to pass all the fields of an hint, when requested. The response is a boolean, True if the hint is ok or False if it's malformed: <br  />
 <div class="fragment"><div class="line">int32 ID</div>
<div class="line">string key</div>
<div class="line">string value</div>
<div class="line">---</div>
<div class="line">bool check</div>
</div><!-- fragment --></li>
<li><em>correct_hyp</em>: the service used to check if there is at least a complete and consistent hypotesis. The response is a string of all the IDs of the hypotesis of this type: <div class="fragment"><div class="line">bool t</div>
<div class="line">---</div>
<div class="line">string hypotesis</div>
</div><!-- fragment --></li>
<li><em>print_res</em>: the service used to request/send the fields of the winning hypotesis. The request is the ID while the response are the field of the hypotesis: <div class="fragment"><div class="line">int32 ID</div>
<div class="line">---</div>
<div class="line">string who</div>
<div class="line">string where</div>
<div class="line">string what</div>
</div><!-- fragment --></li>
<li><em>Oracle</em>: the service used to request the ID of the winning hypotesis: <div class="fragment"><div class="line">---</div>
<div class="line">int32 ID</div>
</div><!-- fragment --></li>
<li><em>Position</em>: the service used to set the postion to reach: <div class="fragment"><div class="line">float32 x</div>
<div class="line">float32 y</div>
<div class="line">float32 theta</div>
<div class="line">---</div>
<div class="line">bool ok</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="autotoc_md6"></a>
Messages</h2>
<p>The only message used in the software is the <em>ErlOracle</em>, that contains all the fields of a generic hint: </p><div class="fragment"><div class="line">int32 ID</div>
<div class="line">string key</div>
<div class="line">string value</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
PDDL</h2>
<p>Relative to the planning part, there are the following files:</p><ul>
<li><code>domain.pddl</code>: the domain file used by the planner where are defined all the predicates and actions;</li>
<li><code>problem.pddl</code>: the problem file used by the planner to read the objects to use in the plan and the goal state we want to achieve;</li>
<li><code>new_problem</code>: in the folder <em>common</em>, the problem generated by ROSplan (same as the file afore mentioned);</li>
<li><code>plan</code>: in the folder <em>common</em>, the plan we want to follow (id something goes wrong, we have to replan). This file can change during the execution of the plan.</li>
</ul>
<p>The plan dispatched has a form of the type:</p>
<p><img src="images_videos/plan_dispatched.jpeg" alt="immagine" class="inline"/></p>
<p>We can see that there are instantiated all the objects used in the plan:</p><ul>
<li><code>w1</code>, <code>w2</code>, <code>w3</code>, <code>w4</code>: the waypoints, that corresponds to the coordinates specified in <em>Moveto</em>;</li>
<li><code>start</code>: the coordinates of <em>home</em>;</li>
<li><code>robot</code>: the agent used in the plan.</li>
</ul>
<h2><a class="anchor" id="autotoc_md8"></a>
Simulation</h2>
<p>In this section are reported some screenshots of the terminal and a brief video of the simulation with some interesting aspects. First of all, we can encounter different kind of hints:</p><ul>
<li><p class="startli">good hint:</p>
<p class="startli"><img src="images_videos/good_hint.jpeg" alt="immagine" class="inline"/></p>
<p class="startli">In this specific case we received an hint corresponding to the ID 5 (where, study). We can see also the output of the ROSplan, where we can see a <code>check_hint</code> action dispatched and executed (so w1 is checked) and the dispatching of the next action <code>move_to</code>;</p>
</li>
<li><p class="startli">malformed hint:</p>
<p class="startli"><img src="images_videos/malformed_hint.jpeg" alt="immagine" class="inline"/></p>
<p class="startli">In this case, it will appear on the terminal that "key is empty or malformed" so one of the fields of the hint are empty or equal to "-1";</p>
</li>
<li><p class="startli">end game with the print:</p>
<p class="startli"><img src="images_videos/end_game.jpeg" alt="immagine" class="inline"/></p>
<p class="startli">In the image we can see the dispatching and execution of the <code>move_home</code> and <code>check_result</code> actions, with the printing of the winner (corresponding to ID 3).</p>
</li>
</ul>
<p>I report also a video that I will briefly explain to make clear what I would like to show. The video is split in two parts:</p><ul>
<li>first part: I want to show, in the gazebo simulation how the robot approaches a waypoint and how it moves the arm in a lower position (thanks to <code>Moveit</code>). The video is sped up because it's a slow movement;</li>
<li>second part: not sped up because I just want to show how the "real" simulation environment (we can look at it in the Rviz tab) is. There are 4 green spheres, that can be high (height od 1.25) or low (height of 0.75), that contains an hint: the robot has to go through it to catch the hint. The spheres are near the waypoint that the robot has to reach.</li>
</ul>
<p><a href="https://www.youtube.com/watch?v=e6bZsWgrhO4">click to the video</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
