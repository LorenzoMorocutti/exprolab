<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Exprolab_Ass1: Experimental Robotics Laboratory</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Exprolab_Ass1
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Experimental Robotics Laboratory </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the repository for the first assignment of he experimental robotics course of Unige.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Description of the repository</h1>
<p>In the repository it's possible to find:</p><ul>
<li><em>launch</em> folder: contains the launch file;</li>
<li><em>msg</em> folder: contains the structure of the ErlOracle messagge;</li>
<li><em>scripts</em> folder: contains the three nodes of the assignment</li>
<li><em>srv</em> folder: contains the structure of the services used in the assignment.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Software Architecture</h1>
<p>We can see in the image below the component diagram of the software:</p>
<p><img src="images/component_diagram.jpg" alt="immagine" class="inline"/></p>
<ul>
<li><b><a class="el" href="namespace_f_s_m.html">FSM</a></b>: The <code><a class="el" href="namespace_f_s_m.html">FSM</a></code> node is the "administrator" of the whole application: it's the node that implements the state machine that rules when the other nodes have to be called. It consists of 4 different states, that will be seen more in detail later on;</li>
<li><b>oracle</b>: The <code>oracle</code> node implements the rule of the oracle. Firstly, it receives, from the fsm, a notice when the robot arrives in a new room so it can give a hint. Secondly, it has also the rule to notify if a complete and consistent hypotesis is the winning one or not;</li>
<li><b>node_hint</b>: Also the <code>node_hint</code> node is very important; indeed it manages everything about the hints received: it loads the ontology and keeps it updated; it check if the hypotesis (that comprehends a 'what', a 'where' and a 'who' field belonging to the same ID) is complete and consistent; sends to the oracle the possible solution. All of this is possible thanks to the armor node;</li>
<li><b>ARMOR</b>: The <code>ARMOR</code> node is the one that "answers" to all the requests that comes from the node_hint about the ontology and management of the hypotesis.</li>
</ul>
<p>In the image is also possible to see which services/topics are used to communicate between the nodes (the lollipop is used for the services while the double arrow is used for the topics of the publishers/subscribers).</p>
<p>About the nodes, it is been also reported the rqt_graph in which are seen only the topics of he publishers/subscribers:</p>
<p><img src="images/rqt_graph.jpeg" alt="immagine" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md3"></a>
State diagram</h2>
<p>In the following image is reported the state diagram, that is the description of the connections between the states of the fsm:</p>
<p><img src="images/state_diagram.jpeg" alt="immagine" class="inline"/></p>
<p>The robot starts in the <em>Goto_new_room</em> state, that in our application is basically a sleep (it should simulates the time the robot needs to change the room); then we always go to the <em>Look_for_hint</em> states where we receive a hint from the oracle and, if it has enough hints to make a complete hypotesis, it goes home, otherwise it returns to the goto_new_rom state; if the hypotesis is complete and consistent we want to check if it's the winning one, so we return home thanks to the <em>Go_home</em> state, that is again a simulation of the movement of returning home (implemented by a sleep); finally, in <em>Check_result</em> we confirms if the hypotesis is the winning one and if it is the goal is reached and we can exit the state machine, otherwise we return to goto_new_room to look for other hints.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Temporal diagram</h2>
<p>In the following image is represented the temporal diagram, of the software:</p>
<p><img src="images/temporal_diagram.jpg" alt="immagine" class="inline"/></p>
<p>It shows in a explicit way the temporal connections of the nodes: we can see that everything starts at the <a class="el" href="namespace_f_s_m.html">FSM</a> node and ends there. The temporal passagges (when the services/topics are called) are to be read from the top to bottom of the diagram (the upper one is the first step, the lower one is the last).</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Services</h2>
<p>The custom services used in the software are the following:</p>
<ul>
<li><em>hint</em>: the service used to pass all the fields of an hint, when requested. The response is a boolean, True if the hint is ok or False if it's malformed: <br  />
 <div class="fragment"><div class="line">int32 ID</div>
<div class="line">string key</div>
<div class="line">string value</div>
<div class="line">---</div>
<div class="line">bool check</div>
</div><!-- fragment --></li>
<li><em>correct_hyp</em>: the service used to check if there is at least a complete and consistent hypotesis. The response is a string of all the IDs of the hypotesis of this type: <div class="fragment"><div class="line">bool t</div>
<div class="line">---</div>
<div class="line">string hypotesis</div>
</div><!-- fragment --></li>
<li><em>result</em>: the service used to request/send the winning hypotesis. The request is the ID while the response are the field of the hypotesis: <div class="fragment"><div class="line">int32 ID</div>
<div class="line">---</div>
<div class="line">bool win</div>
<div class="line">string who</div>
<div class="line">string where</div>
<div class="line">string what</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="autotoc_md6"></a>
Messages</h2>
<p>The only message used in the software is the <em>ErlOracle</em>, that contains all the fields of a generic hint: </p><div class="fragment"><div class="line">int32 ID</div>
<div class="line">string key</div>
<div class="line">string value</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
Smach State Machine</h2>
<p>The implementation of the finite state machine has been done thanks to the <code>smach</code> library, in which we have just to write the code to be executed at each state. There is also a useful tool that is <code>smach_viewer</code> that allows us to visualize the structure of the fsm:</p>
<p><img src="images/temporal_diagram.jpg" alt="immagine" class="inline"/></p>
<p>The image, as expected, is the same as the state diagram. It is possible, in the terminal, to see the following screenshots:</p>
<p><img src="images/initial_states.jpeg" alt="immagine" class="inline"/></p>
<p>These are the first states of the fsm where we can see the change of state from <em>look_for_hint</em> to <em>goto_new_room</em> and vice versa. In the screen we can see that the hint "ID: 2" "who" "Ciro" has been received and, since we haven't received enough hint for the ID: 2, we go to a new room.</p>
<p>In the second image is possible to see the final states of the fsm:</p>
<p><img src="images/final_states.jpeg" alt="immagine" class="inline"/></p>
<p>We have received enough hints to make a hypotesis for the ID: 1, so we <em>go_home</em> and <em>check_result</em>. We were lucky and the ID: 1 was the correct answer, so we can also see the final print of the culprit.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Running the code</h1>
<p>To run the code we actually just have to clone this branch of the repository in our catkin_ws, run the <code>catkin_make</code>, go to the scripts folder and digit: </p><div class="fragment"><div class="line">chmod +x script1_name.py script2_name.py ...</div>
</div><!-- fragment --><p>for every .py file.</p>
<p>Then we just write in the terminal: </p><div class="fragment"><div class="line">roslaunch exprolab_ass1 assignment.launch</div>
</div><!-- fragment --><p>to launch all the nodes.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Working Hypotesis and Environment</h1>
<p>The environment in which the robot moves is immaginary, so the robot's actions aren't real but just simulated. However, the node created are easily adaptable to a Gazebo simulation (for example) with the addition of some codes in the finite state machine.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
System's Features</h2>
<p>The system is very modular, each node handles a different task: <code>oracle</code> gives the hints, <code><a class="el" href="namespacecreate__hypotesis.html">create_hypotesis</a></code> manages all the hint's aspects and <code>fsm</code> manage the robot's actions.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
System's Limitations</h2>
<p>The hints managed by the robot are complete (it can manage also malformed or empty hints, because I already know that it would be an aspect in the next assignments) but the ontology is not readable when updated and the terminal output is difficult to read if someone is not familiar with the smach output.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Possible Techical Improvements</h2>
<p>It would be nice to test this branch with a simulation environment instead of using simulated actions and it could be useful to have a more user friendly interface to manage the output of the various nodes. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
